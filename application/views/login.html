<!DOCTYPE html>
<html ng-app="login">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>SUPERLUCKY</title>
<script src="/asset/js/angular.js"></script>
<script src="/asset/js/ui_bootstrap.js"></script>

<link rel="stylesheet" type="text/css" href="/asset/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="/asset/css/login.css" />
</head>
<body>

<div ng-controller="loginController" class="container">
<form method="post" action="" class="form-signin" >
	<h2 class="form-signin-heading">LOGIN</h2>
	<input ng-model="id"   name="id"   type="text"     class="form-control" placeholder="Id" autofocus />
	<input ng-model="pass" ng-enter="login_button()"  name="pass" type="password" class="form-control" placeholder="Pass" />
	<button ng-click="login_button()" class="btn btn-lg btn-primary btn-block" type="button">LOGIN</button>
</form>
</div>
<div ng-controller="dialogController" style="display:none">
<script type="text/ng-template" id="myModalContent.html">
	<div class="modal-header">
		<h3 class="modal-title">Message</h3>
	</div>
	<div class="modal-body">
		Fail Login!
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="ok()">OK</button>
	</div>
</script>

</div>

<script>
var login = angular.module('login', ['ui.bootstrap']);
login.dialog_instance = null;

// enter Event
login.directive('ngEnter', function () {
    return function (scope, element, attrs) {
        element.bind("keydown keypress", function (event) {
            if(event.which === 13) {
                scope.$apply(function (){
                    scope.$eval(attrs.ngEnter);
                });
                event.preventDefault();
            }
        });
    };
});





login.controller('loginController', function ($scope,$http,$modal) {

	var open = function (size) {
		login.dialog_instance = $modal.open({
			templateUrl: 'myModalContent.html',
			controller: 'dialogController',
			size: size,
			resolve: {}
		});
	};



	// Login Event
	$scope.login_button = function(){
		$http({
			url: '/user/login',
			method: "POST",
			data: {
				id   : $scope.id,
				pass : $scope.pass
			}
		}).
		success(function(data){
			if(data.result == 'true'){
				location.replace('/');
			}
			else{
				//alert('fail');
				open('sm');
			}
		}).
		error(function(data){
			alert('서버오류 입니다.');
		});
	}
});


login.controller('dialogController', function ($scope) {
	$scope.ok = function(){
		login.dialog_instance.dismiss('cancel');
	};
});

</script>
</body>
</html>
